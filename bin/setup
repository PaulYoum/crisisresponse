#!/bin/sh

# Set up Rails app. Run this script immediately after cloning the codebase.
# https://github.com/thoughtbot/guides/tree/master/protocol

# Exit if any subcommand fails
set -e

# Add binstubs to PATH via export PATH=".git/safe/../../bin:$PATH" in ~/.zshenv
mkdir -p .git/safe

# Make sure .env.local exists - our docker-compose configuration depends on it.
touch .env.local

# Only if this isn't CI
if [ -z "$CI" ]; then
  docker pull docker/compose:1.8.0

  # Build the docker image
  ./bin/docker-compose build

  # Set up the database for our app
  ./bin/docker-compose run web rake db:create db:migrate
  ./bin/docker-compose run web rake db:seed
fi
